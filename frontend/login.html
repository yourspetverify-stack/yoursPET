<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - YoursPET</title>
    <link rel="stylesheet" href="login.css">
    <style>
        .hidden { display: none; }
        .otp-section { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="login-bg">
        <div class="login-container" style="background: rgba(255, 255, 255, 0.15);  
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px 20px 20px 20px;
            width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.9);
            /* Optional shadow for depth */
            box-shadow: inset 2px 2px 25px 4px rgba(249, 233, 233, 0.2);">
            <form class="login-form" id="login-form"
            style="
            padding-top: 20px;
            padding-left: 50px;
            padding-right: 50px;
            padding-bottom: 50px;
                width: 300px;
                height: 450px;">
                <div>
                    <img src="logo.png" alt="Logo" style="width:130px;height:130px;object-fit:cover;border: none;display:block;" />
                </div>
                <input id="login-username" style="padding: 12px 12px; border: none; border-radius: 10px; color: #000; font-size: 16px; cursor: pointer; transition: background 0.2s; width: 100%; margin-top: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.03);" type="text" placeholder="Username" required>
                <div style="position:relative;width:100%;margin-top:10px;margin-left:auto;margin-right:auto;">
                    <input id="login-password" style="padding: 12px 12px; border: none; border-radius: 10px; color: #000; font-size: 16px; cursor: pointer; transition: background 0.2s; width: 100%; box-shadow: 0 2px 8px rgba(0,0,0,0.03); margin-left: -12px;" type="password" placeholder="Password" required>
                    <button type="button" id="toggle-login-password" style="position:absolute;right:8px;top:13px;transform:translateY(-50%);background:transparent;border:none;cursor:pointer;padding:0;height:28px;width:28px;display:flex;align-items:center;justify-content:center;z-index:2;">
                        <svg id="login-eye" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#2e8fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="12" rx="8" ry="5"/><circle cx="12" cy="12" r="2.5" fill="#2e8fff"/></svg>
                    </button>
                </div>
                <div style="width:100%;text-align:right;margin-bottom:10px;"></div>
                <button id="login-btn" class="styled-signup-link" type="submit" style="margin-bottom:0;margin-top:-30px;">Login</button>
                <a href="signup.html" class="styled-signup-link" style="margin-top:5px;">Sign up</a>
                <a href="#" id="forgot-link" class="styled-signup-link" style="margin-top: 5px;">Forgot password?</a>
            </form>

            <!-- Forgot Password Modal/Section -->
            <div id="forgot-section" class="otp-section hidden"
            style="margin-left: 25px;
            margin-top: -20px;">
                <h3>Forgot Password</h3>
                <input id="forgot-email"
                style="padding: 12px 12px; 
                border: none; border-radius: 10px; color: #000; font-size: 16px; cursor: pointer; transition: background 0.2s;width: 312px;
                margin-top: 5px;
                margin-left: 10px;
                 box-shadow: 0 2px 8px rgba(0,0,0,0.03);" type="email" placeholder="Enter your email" required>
                <button id="send-forgot-otp-btn" style="width: 90%;
                padding: 12px 0;
                border: none;
                border-radius: 25px;
                font-size: 18px;
                font-weight: bold;
                color: #fff;
                margin-top: 10px;
                margin-bottom: 0;
                margin-left: 10px;
                cursor: pointer;
                background: linear-gradient(90deg, #2ec4ff 0%, #38e49c 100%);
                transition: background 0.2s;
                display: block;
                text-align: center;
                text-decoration: none;"
                type="button">Send OTP</button>
                <div id="forgot-otp-area" class="hidden">
                    <input style="width: 240px;
                    height: 30px;
                    margin-top: 15px;
                    margin-left: 45px;
                    border: none;
                    padding-left: 10px;
                    border-radius: 5px;" id="forgot-otp" type="text" 
                    placeholder="Enter OTP" maxlength="6">
                    <button style="width: 80px;
                    height: 30px;
                    margin-top: 15px;
                    margin-left: 128px;
                    border: none;
                    color: white;
                    border-radius: 15px;
                    cursor: pointer;
                    background: linear-gradient(90deg, #2ec4ff 0%, #38e49c 100%);
                    transition: background 0.2s;"
                    id="verify-forgot-otp-btn" type="button">Verify OTP</button>
                </div>
                <div id="reset-area" class="hidden">
                    <input id="reset-password" type="password" placeholder="New Password">
                    <button id="reset-password-btn" type="button">Reset Password</button>
                </div>
                <button id="close-forgot-btn" 
                style="width: 90%;
                padding: 12px 0;
                border: none;
                border-radius: 25px;
                font-size: 19px;
                font-weight: bold;
                color: #fff;
                margin-top: 10px;
                margin-bottom: 10px;
                margin-left: 10px;
                cursor: pointer;
                background: linear-gradient(90deg, #2ec4ff 0%, #38e49c 100%);
                transition: background 0.2s;
                display: block;
                text-align: center;
                text-decoration: none;" type="button">Close</button>
            </div>
        </div>
    </div>
    <script>

    // Login handler
    document.getElementById('login-form').onsubmit = async function(e) {
        e.preventDefault();
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value;
        const res = await fetch('https://yourspet.onrender.com/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        if (data.success) {
            // Store email for later requests
            sessionStorage.setItem('user_email', data.email);
            window.location.href = "dashboard.html";
        } else {
            alert(data.message || 'Login failed');
        }
    };

    // Forgot password flow
    const forgotSection = document.getElementById('forgot-section');
    document.getElementById('forgot-link').onclick = function(e) {
        e.preventDefault();
        forgotSection.classList.remove('hidden');
    };
    document.getElementById('close-forgot-btn').onclick = function() {
        forgotSection.classList.add('hidden');
        document.getElementById('forgot-email').value = '';
        document.getElementById('forgot-otp-area').classList.add('hidden');
        document.getElementById('reset-area').classList.add('hidden');
    };

    document.getElementById('send-forgot-otp-btn').onclick = async function() {
        const email = document.getElementById('forgot-email').value.trim();
        if (!email) return alert('Enter your email');
        const res = await fetch('https://yourspet.onrender.com/send-otp', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ email, purpose: 'forgot' })
        });
        const data = await res.json();
        if (data.success) {
            alert('OTP sent to your email (and your username)');
            document.getElementById('forgot-otp-area').classList.remove('hidden');
        } else {
            alert(data.message || 'Failed to send OTP');
        }
    };

    document.getElementById('verify-forgot-otp-btn').onclick = async function() {
        const email = document.getElementById('forgot-email').value.trim();
        const otp = document.getElementById('forgot-otp').value.trim();
        if (!otp) return alert('Enter the OTP');
        const res = await fetch('https://yourspet.onrender.com/verify-otp', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ email, otp })
        });
        const data = await res.json();
        if (data.success) {
            alert('OTP verified. Please reset your password.');
            document.getElementById('reset-area').classList.remove('hidden');
        } else {
            alert(data.message || 'OTP verification failed');
        }
    };

    document.getElementById('reset-password-btn').onclick = async function() {
        const email = document.getElementById('forgot-email').value.trim();
        const new_password = document.getElementById('reset-password').value;
        if (!new_password) return alert('Enter a new password');
        const res = await fetch('https://yourspet.onrender.com/reset-password', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ email, new_password })
        });
        const data = await res.json();
        if (data.success) {
            alert('Password reset successful! You can now login.');
            forgotSection.classList.add('hidden');
        } else {
            alert(data.message || 'Password reset failed');
        }
    };
    </script>
    <script>
        // Toggle password visibility and show button only when input has value
        (function() {
            var loginPwd = document.getElementById('login-password');
            var loginToggle = document.getElementById('toggle-login-password');
            if (loginPwd && loginToggle) {
                loginToggle.style.display = 'none';
                loginPwd.addEventListener('input', function() {
                    loginToggle.style.display = loginPwd.value.length > 0 ? 'flex' : 'none';
                });
                loginToggle.addEventListener('click', function() {
                    if (loginPwd.type === 'password') {
                        loginPwd.type = 'text';
                    } else {
                        loginPwd.type = 'password';
                    }
                });
            }
        })();
    </script>
</body>
</html>
